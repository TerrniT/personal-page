---
import { useI18n, getLangFromUrl } from '@lib/i18n'
import { getPostInfoList, type ArticleInfo } from '@lib/mdx'

import { ArticleCard } from '@components/astro/modules/article'

import PageLayout from '@layouts/PageLayout.astro'

const { url } = Astro
const { t } = useI18n(url)
const lang = getLangFromUrl(url)

const data = await getPostInfoList(lang)

type Acc = {
  [year: string]: ArticleInfo[]
}

const posts = data.reduce((acc: Acc, post) => {
  const year = post.date.getFullYear().toString()
  if (!acc[year]) {
    acc[year] = []
  }
  acc[year].push(post)
  return acc
}, {})

const years = Object.keys(posts).sort((a, b) => parseInt(b) - parseInt(a))
---

<PageLayout title={t('articles.title')} description={t('articles.description')}>
  <h1 class="animate text-xl font-semibold">{t('articles.heading')}</h1>
  <div class="space-y-16">
    <section>
      <article class="space-y-4">
        <p class="animate">
          {t('articles.paragraph')}
        </p>
      </article>
    </section>
  </div>
  <div class="mt-14 space-y-4">
    {
      years.map((year) => (
        <section class="animate space-y-4">
          <div class="font-semibold">{year}</div>
          <div>
            <ul class="grid grid-cols-2 gap-2">
              {posts[year].map((post) => (
                <li>
                  <ArticleCard item={post} />
                </li>
              ))}
            </ul>
          </div>
        </section>
      ))
    }
  </div>
</PageLayout>
